oopipeline {
  agent any
  stages {
    stage('Git CLoning') {
      steps {
        git(url: 'https://github.com/yaseensec/Jenkinsfiles.git', branch: 'master')
      }
    }

    stage('Build') {
      parallel {
        stage('Build') {
          steps {
            sh 'ls /tmp'
            sh 'ls -al /tmp'
          }
        }

        stage('Test Step') {
          steps {
            sleep 10
            sh 'ls -al /tmp'
          }
        }

      }
    }

    stage('Test') {
      parallel {
        stage('Test') {
          steps {
            sh 'ls /usr/bin'
          }
        }

        stage('Test1') {
          steps {
            sh 'ls -al /var/lib'
          }
        }

      }
    }

    stage('docker rmi') {
      steps {
        sh '''docker images
'''
        sh 'docker rmi $(docker images --format \'{{.Repository}}:{{.Tag}}\' | grep \'014357505841.dkr.ecr.ap-south-1.amazonaws.com/erp\')'
      }
    }

  }
}

pipeline {
    agent any

    stages {
        stage('Get Parameters') {
            steps {
                script {
                    def paramMap = [:]  // Initialize an empty map

                    // Loop through all available parameters
                    params.each { paramName, paramValue ->
                        if (paramValue) {
                            paramMap[paramName] = paramValue
                        }
                    }

                    // Print the parameter map for verification
                    echo "Parameter Map: ${paramMap}"

                    // Pass paramMap to the next stage
                    build job: 'NextJob', parameters: [string(name: 'paramMap', value: paramMap.inspect())]
                }
            }
        }
    }
}


pipeline {
    agent any

    stages {
        stage('Next Stage') {
            steps {
                script {
                    def paramMap = evaluate("return ${params.paramMap}")

                    // Loop through paramMap and access parameter names and values
                    paramMap.each { paramName, paramValue ->
                        echo "Parameter Name: ${paramName}"
                        echo "Parameter Value: ${paramValue}"
                        
                        // Perform actions based on parameter name and value
                        // Example: if (paramName == 'global') { /* do something */ }
                    }
                }
            }
        }
    }
}



pipeline {
    agent any

    stages {
        stage('Run Ansible Playbook for Filled Parameters') {
            steps {
                script {
                    def paramMap = [:]  // Initialize an empty map

                    // Loop through all available parameters
                    params.each { paramName, paramValue ->
                        if (paramValue) {
                            paramMap[paramName] = paramValue
                        }
                    }

                    // Print the parameter map for verification
                    echo "Parameter Map: ${paramMap}"

                    // Loop through paramMap and run Ansible playbook for each filled parameter
                    paramMap.each { paramName, paramValue ->
                        // Run Ansible playbook with parameterName and parameterValue as variables
                        sh """
                            ansible-playbook your_playbook.yml \
                            -e "paramName=${paramName}" \
                            -e "paramValue=${paramValue}"
                        """
                    }
                }
            }
        }
    }
}

pipeline {
    agent any

    stages {
        stage('Run Ansible Playbook for Filled String Parameters') {
            steps {
                script {
                    def paramMap = [:]  // Initialize an empty map

                    // Filter and process only string parameters
                    def stringParams = params.findAll { paramName, paramValue ->
                        paramValue instanceof String
                    }

                    // Loop through the filtered string parameters
                    stringParams.each { paramName, paramValue ->
                        paramMap[paramName] = paramValue
                    }

                    // Print the parameter map for verification
                    echo "Parameter Map: ${paramMap}"

                    // Loop through paramMap and run Ansible playbook for each filled string parameter
                    paramMap.each { paramName, paramValue ->
                        // Run Ansible playbook with parameterName and parameterValue as variables
                        sh """
                            ansible-playbook your_playbook.yml \
                            -e "paramName=${paramName}" \
                            -e "paramValue=${paramValue}"
                        """
                    }
                }
            }
        }
    }
}